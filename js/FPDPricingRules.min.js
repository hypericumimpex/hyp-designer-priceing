/*
* Fancy Product Designer Pricing Rules 1.0.5 
* An Add-On for Fancy Product Designer. 
* Copyright 2017, Rafael Dery
*
* Only for the sale at the envato marketplaces
*/
var FPDPricingRules=function(a,b){"use strict";var c=this;this.doPricingRules=function(){b.pricingRulesPrice=0;var c=b.mainOptions.pricingRules;c&&c.length>0&&c.forEach(function(a){var c=[];void 0!==a.target.elements&&"#"===a.target.elements.charAt(0)?c.push(b.getElementByTitle(a.target.elements.replace("#",""),a.target.views)):c=void 0!==a.target.elements&&-1!==a.target.elements.search("custom")?b.getCustomElements(a.target.elements.replace("custom","").toLowerCase(),a.target.views,!1):b.getElements(a.target.views,a.target.elements,!1);var e,f=!1;-1!==["elementsLength","colorsLength"].indexOf(a.property)&&(f=!0),c.forEach(function(g,h){!g||f&&h>0||(g.hasOwnProperty("element")&&(g=g.element),"textLength"===a.property?e=g.text?g.text.length:null:"linesLength"===a.property?e=g.text?g.text.split("\n").length:null:"imageSize"===a.property?e="image"===FPDUtil.getType(g.type)&&g.title?{width:g.width,height:g.height}:null:"imageSizeScaled"===a.property?e="image"===FPDUtil.getType(g.type)&&g.title?{width:g.width*g.scaleX,height:g.height*g.scaleY}:null:"elementsLength"===a.property?e=c.length:"colorsLength"===a.property&&(e=b.getUsedColors(a.target.views).length),null!==e&&(a.rules.forEach(function(a){a.property=e}),"any"===a.type?a.rules.some(d):a.rules.forEach(d)))})});var e=b.calculatePrice();a.trigger("priceChange",[null,e,b.singleProductPrice])};var d=function(a){return e(a.operator,a.property,a.value)?("number"==typeof a.price&&(b.pricingRulesPrice+=a.price),!0):!1},e=function(a,b,c){if("object"==typeof c){var d=Object.keys(c),e=null;return d.forEach(function(d){e!==!1&&(e=f(a,b[d],c[d]))}),e}return f(a,b,c)},f=function(a,b,c){return"="===a?b===c:">"===a?b>c:"<"===a?c>b:">="===a?b>=c:"<="===a?c>=b:void 0};a.on("elementModify productCreate elementAdd elementRemove",function(){b.productCreated&&c.doPricingRules()})};